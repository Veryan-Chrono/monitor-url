<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>GOLO Test</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
</head>

<body>
    <container>
        <h1>Monitor the Status or a URL</h1>
        <form action="#" th:action="@{/}" th:object="${monitor}" method="post">
            <div class="row">
                <div class="col">
                    <table>
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Server Satus</th>
                            </tr>
                        </thead>
                        <tbody id="tbody">
                            <tr th:each="stat : *{statuses}">
                                <td th:text="${stat.time}"></td>
                                <td th:text="${stat.status}"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="col">
                    <p>Interval (in Milliseconds):
                        <input type="text" th:field="*{interval}" />
                    </p>
                    <p>URL:
                        <input type="text" th:field="*{url}" />
                    </p>
                    <p th:text="*{message}"></p>
                    <p>
                        <input type="submit" value="Start/Update" />
                        <button><a href="/stop">Stop</a></button>
                    </p>
                </div>
            </div>
        </form>
    </container>
</body>

</html>
<script type="application/javascript">
    var eventSource = new EventSource("http://localhost:9000/stream");

    function add(message) {
        var tbody = document.getElementById('tbody');
        var tr = document.createElement("tr");
        var td = document.createElement("td");
        var newRow = tbody.insertRow();
        var time = newRow.insertCell(0);
        var status = newRow.insertCell(1);
        if (tbody.rows.length > 10) {
            tbody.deleteRow(0);
        }
        time.appendChild(document.createTextNode(message.time));
        status.appendChild(document.createTextNode(message.status));
    }

    eventSource.onmessage = function(e) {
        var message = JSON.parse(e.data);
        add(message);
    }

    eventSource.onerror = function(e) {
        if (e.readyState === EventSource.CONNECTING) {
            console.log('event: CONNECTING');
        } else if (e.readyState === EventSource.OPEN) {
            console.log('event: OPEN');
        } else if (e.readyState === EventSource.CLOSING) {
            console.log('event: CLOSING');
        } else if (e.readyState === EventSource.CLOSED) {
            console.log('event: CLOSED');
        }
    }
    if (!window.EventSource) {
        alert('The browser does not support Server-Sent Events');
    }
</script>
<style>
    container {
        display: block;
        padding: 30px 20%;
    }
    
    a {
        text-decoration: none;
        color: black;
    }
    
    table {
        border-collapse: collapse;
    }
    
    table,
    th,
    td {
        border: 1px solid black;
        padding: 5px;
    }
</style>
